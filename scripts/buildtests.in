#!/bin/bash

if [ $# == 0 -o $# -ge 3 ]
then
  echo "usage: ./buildtests regexp [jobs]"
  echo "  makes tests matching the regexp, with [jobs] concurrent make jobs"
  exit 0
fi

TESTSLIST="${EIGEN_TESTS_LIST}"

targets_to_make=`echo "$TESTSLIST" | egrep "$1" | sed s/^/test_/g | xargs echo`

if [ $# == 1 ]
then
  make $targets_to_make
  exit $?
fi

if [ $# == 2 ]
then
  make -j $2 $targets_to_make
  exit $?
fi
